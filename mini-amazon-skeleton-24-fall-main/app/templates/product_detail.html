{% extends "base.html" %}

{% block content %}
<style>
    .btn,
    button,
    input[type="submit"] {
        background-color: #000000 !important;
        color: #ffffff !important;
        border-color: #000000;
    }

    .btn:hover,
    button:hover,
    input[type="submit"]:hover {
        background-color: #333333 !important;
        border-color: #333333;
    }
</style>

<div class="container mx-auto px-4 py-8">
    <!-- Add flash messages section -->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-info" role="alert">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md overflow-hidden">
        <div class="md:flex">
            <!-- Product Image -->
            <div style="height: 50%; width: 50%; overflow: hidden;">
                {% if product.image_url %}
                <a href="{{ url_for('products.product_detail', product_id=product.id) }}">
                    <img src="{{ product.image_url }}" alt="{{ product.name }}"
                        style="width: 100%; height: 100%; object-fit: cover;">
                </a>
                {% else %}
                <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                    <span class="text-gray-500">No image available</span>
                </div>
                {% endif %}
            </div>

            <!-- Product Details Section -->
            <div class="p-8 md:w-1/2">
                <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">
                    Product ID: {{ product.id }}
                </div>

                <h1 class="mt-2 text-3xl font-bold text-gray-900">{{ product.name }}</h1>

                <!-- Price -->
                <div class="mt-4">
                    <span class="text-3xl font-bold text-gray-900">${{ "%.2f"|format(product.price) }}</span>
                </div>

                <!-- Rating -->
                <div class="mt-4 flex items-center">
                    <div class="flex">
                        {% for i in range(5) %}
                        <span
                            class="text-xl {% if i < product.avg_rating|int %}text-yellow-400{% else %}text-gray-300{% endif %}">★</span>
                        {% endfor %}
                    </div>
                    <span class="ml-2 text-gray-600">
                        {{ "%.1f"|format(product.avg_rating) }} ({{ product.review_count }} reviews)
                    </span>
                </div>

                <!-- Description -->
                {% if product.description %}
                <div class="mt-4">
                    <h2 class="text-xl font-semibold mb-2">Description</h2>
                    <p class="text-gray-600">{{ product.description }}</p>
                </div>
                {% endif %}

                <!-- Additional Details -->
                <div class="mt-6 space-y-2">
                    <p class="text-gray-600">
                        <span class="font-semibold">Category:</span>
                        {{ Category.get_name(product.category_id) if product.category_id else "Uncategorized" }}
                    </p>
                    <p class="text-gray-600">
                        <span class="font-semibold">Seller ID: (Click for more info)</span>
                        <a href="{{ url_for('users.pubPage', user_id=product.seller_id) }}">{{product.seller_id }}</a>
                    </p>

                    


                    <p class="text-gray-600">
                        <span class="font-semibold">Status:</span>
                        {% if product.available and product.quantity is not none and product.quantity > 0 %}
                        <span class="text-green-600">{{ product.quantity }} in Stock</span>
                        {% else %}
                        <span class="text-red-600">Out of Stock</span>
                        {% endif %}
                    </p>

                    <!-- Sellers Section -->
                    <div class="mt-6">
                        <h2 class="text-xl font-semibold mb-4">Available Sellers</h2>
                        <div class="space-y-4">
                            {% for seller in sellers %}
                            <div class="border rounded p-4">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <a href="{{ url_for('users.pubPage', user_id=seller.seller_id) }}" 
                                           class="text-blue-600 hover:underline">
                                            Seller ID: {{ seller.seller_id }}
                                        </a>
                                        <p class="text-gray-600">Price: ${{ "%.2f"|format(seller.price) }}</p>
                                        <p class="text-gray-600">
                                            {% if seller.quantity > 0 %}
                                            <span class="text-green-600">{{ seller.quantity }} in Stock</span>
                                            {% else %}
                                            <span class="text-red-600">Out of Stock</span>
                                            {% endif %}
                                        </p>
                                    </div>
                                    {% if seller.quantity > 0 and current_user.is_authenticated %}
                                    <form action="{{ url_for('products.add_to_cart', product_id=product.id, seller_id=seller.seller_id) }}" 
                                          method="POST" 
                                          class="flex items-center gap-2">
                                        <input type="number" 
                                               name="quantity" 
                                               value="1" 
                                               min="1" 
                                               max="{{ seller.quantity }}" 
                                               class="w-20 p-2 border rounded">
                                        <button type="submit" 
                                                class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800">
                                            Add to Cart
                                        </button>
                                    </form>
                                    {% elif not current_user.is_authenticated %}
                                    <a href="{{ url_for('users.login') }}" 
                                       class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800">
                                        Login to Buy
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Reviews Section -->
                    <div class="mt-8">
                        <h2 class="text-xl font-semibold mb-4">Product Reviews</h2>
                        {% if purchased %}
                        <br>
                        <p class="text-gray-600">
                            <span class="font-semibold">Since you bought this product, leave a Review: </span>
                        </p>
                        <form action="" method="post">
                            {{ form.hidden_tag() }}
                            <p>
                                {{ form.rscore.label }}<br />
                                {{ form.rscore(size=32) }}<br />
                                {% for error in form.rscore.errors %}
                                <span style="color: red;">[{{ error }}]</span>
                                {% endfor %}
                            </p>
                            <p>{{ form.submit() }}</p>
                        </form>
                        {% endif %}

                        {% if reviews %}
                        <div class="space-y-4">
                            {% for review in reviews %}
                            <div class="border rounded p-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="flex">
                                        {% for i in range(5) %}
                                        <span class="text-lg {% if i < review.rscore %}text-yellow-400{% else %}text-gray-300{% endif %}">★</span>
                                        {% endfor %}
                                    </div>
                                    <span class="text-gray-600">by User {{ review.uid }}</span>
                                    <span class="text-gray-400">{{ review.time_reviewed.strftime('%Y-%m-%d') }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-gray-600">No reviews yet.</p>
                        {% endif %}
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}